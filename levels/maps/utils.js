import { k } from "/kaboom.js";
import { tween } from "/utils.js";
import * as misc from "/objects/misc.js";
import * as powerups from "/objects/powerups.js";
import { spawnObject } from "/levels/spatial.js";

export const monsterWave = (spawner) => {
  return new Promise((resolve) => {
    let killed = 0;
    const wave = spawner();
    // grace period before attacking player
    wave.forEach(m => {
      m.solid = false;
      m.aiEnabled = false;
      if (!m.color) m.use(k.color(1, 1, 1, 0));
      tween(m, 1, { "color.a": 1 }).then(() => {
        m.solid = true;
        m.aiEnabled = true;
      });
    });
    const handleDeath = () => {
      killed++;
      if (killed === wave.length) resolve();
    };
    wave.forEach(obj => obj.on("death", handleDeath));
  });
};

export const coinReward = (...locations) => {
  return locations.map(loc => spawnObject(powerups.coin(), ...loc));
};

export const crateWall = (...locations) => {
  return locations.map(loc => spawnObject(misc.crate(), ...loc));
}

export const nullMap = [
  "@",
];

export const testSecretsMap = [
  "┌─_──_──_──┐",
  "│..........│",
  "│.^^^^^^^^./",
  "/.^......^.│",
  "│.^......^.│",
  "│.^.@..m.^.│",
  "/.^......^./",
  "│.^......^.│",
  "│.^......^.│",
  "│.^^^^^^^^.│",
  "│..........│",
  "└────_──_──┘",
];

export const smallTestMap = [
  "┌──────────┐",
  "│··········│",
  "│·^^^^^^^^·│",
  "│·^····?·^·│",
  "│·^·@····^·│",
  "│·^·····?^·│",
  "│·^······^·│",
  "│·^···?··^·│",
  "│·^······^·│",
  "│·^^^^^^^^·│",
  "│··········│",
  "└──────────┘",
];

export const fullTestMap = [
  "         ┌───────┐                                               ",
  "         │.......│                                               ",
  " ┌───────┘...c...│                                               ",
  "┌┘...............└─────)─(─}─{─&──%──!─{─}─(─)──────────────────┐",
  "│....................?..........................................│",
  "│...>............M..................o..i..z..g..D..d..w..s......│",
  "│...........^...................f...............................│",
  "│.......f.............$.......................Z.............w...│",
  "│....................$$$........................................│",
  "│...f.....###.........$.....................z......g............│",
  "│.........#?#..................@.......i........................│",
  "│.....f...#.#...................................................│",
  "│.............┌─┐..........................S............o.......│",
  "│.......f....┌┘ └┐.............m................................│",
  "│...........┌┘   └┐............................n................│",
  "│..........┌┘     └┐...............O.....................s......│",
  "│..........│       │............................................│",
  "└──────────┘       └─┐..........................................│",
  "                     └────────┐...┌─)─(─}─{─&──%──!─{─}─(─)─────┘",
  "                              │...│                              ",
  "                             ┌┘...│    ┌──────────────────────┐  ",
  "                         ┌───┘..┌─┘    │......................│  ",
  "                         │......│     ┌┘......................│  ",
  "                         │.┌────┘    ┌┘.......................│  ",
  "                         │.│        ┌┘........................│  ",
  "                         │.└────────┘.........................│  ",
  "                         │....................................│  ",
  "                         └────────────────────────────────────┘  ",
];